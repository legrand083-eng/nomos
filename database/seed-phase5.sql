-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOMOÎ£ Phase 5 â€” Seed Data (Email Templates + Performance)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Insert all 24 email templates
INSERT INTO email_templates (code, category, objet_template, contenu_template, destinataire_role, variables) VALUES
-- Workflow (8 templates)
('RAPPEL_DEPOT_J5', 'workflow', 'Rappel â€” DÃ©pÃ´t situation avant le {deadline}', 'Bonjour {entreprise_name},\n\nNous vous rappelons que la date limite de dÃ©pÃ´t de votre situation de travaux pour {mois} est le {deadline}.\n\nOpÃ©ration : {operation_name}\nLot : {lot_name}\n\nMerci de dÃ©poser votre situation via NOMOÎ£.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,deadline,mois,operation_name,lot_name,moe_name'),
('RELANCE_DEPOT_J3', 'workflow', 'RELANCE â€” Situation non reÃ§ue â€” {lot_name}', 'Bonjour {entreprise_name},\n\nNous n''avons pas reÃ§u votre situation de travaux.\nDate limite : {deadline} (dans 3 jours).\n\nSans dÃ©pÃ´t dans les dÃ©lais, des pÃ©nalitÃ©s pourront Ãªtre appliquÃ©es conformÃ©ment au CCAP.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,deadline,lot_name,moe_name'),
('RELANCE_DEPOT_J1', 'workflow', 'DERNIER RAPPEL â€” DÃ©pÃ´t demain â€” {lot_name}', 'Bonjour {entreprise_name},\n\nâš ï¸ DERNIER RAPPEL : votre situation doit Ãªtre dÃ©posÃ©e DEMAIN au plus tard.\n\nOpÃ©ration : {operation_name}\nLot : {lot_name}\nDate limite : {deadline}\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,deadline,operation_name,lot_name,moe_name'),
('CONFIRM_RECEPTION', 'workflow', 'Confirmation â€” Situation nÂ°{numero} reÃ§ue', 'Bonjour {entreprise_name},\n\nNous accusons rÃ©ception de votre situation de travaux nÂ°{numero}.\n\nOpÃ©ration : {operation_name}\nLot : {lot_name}\nMontant dÃ©clarÃ© : {montant} â‚¬ HT\nDate de dÃ©pÃ´t : {date}\n\nVotre situation va Ãªtre contrÃ´lÃ©e par l''OPC puis le MOE.\n\nCordialement,\nNOMOÎ£', 'entreprise', 'entreprise_name,numero,operation_name,lot_name,montant,date'),
('SIGNATURE_REQUISE', 'workflow', 'Certificat nÂ°{numero_certificat} â€” Signature requise', 'Bonjour {entreprise_name},\n\nLe certificat de paiement nÂ°{numero_certificat} est prÃªt pour votre signature.\n\nMontant net Ã  payer : {montant} â‚¬\n\nConnectez-vous Ã  NOMOÎ£ pour vÃ©rifier et signer le certificat.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,numero_certificat,montant,moe_name'),
('SIGNATURE_CONFIRMEE', 'workflow', 'Signature confirmÃ©e â€” Certificat {numero_certificat}', 'Bonjour,\n\nLa signature du certificat nÂ°{numero_certificat} a Ã©tÃ© confirmÃ©e.\n\nSignÃ© par : {signataire}\nDate : {date}\n\nLe certificat sera transmis au MaÃ®tre d''Ouvrage.\n\nCordialement,\nNOMOÎ£', 'moe', 'numero_certificat,signataire,date'),
('TRANSMISSION_MOA', 'workflow', 'Certificat de paiement â€” {lot_name} â€” Situation nÂ°{numero}', 'Monsieur,\n\nVeuillez trouver ci-joint le certificat de paiement pour :\n\nOpÃ©ration : {operation_name}\nLot : {lot_name}\nEntreprise : {entreprise_name}\nSituation nÂ°{numero}\nMontant net Ã  payer : {montant} â‚¬\n\nCordialement,\n{moe_name}', 'moa', 'operation_name,lot_name,entreprise_name,numero,montant,moe_name'),
('AR_CONFIRME', 'workflow', 'AR confirmÃ© â€” Certificat {numero_certificat}', 'Bonjour {moe_name},\n\nL''accusÃ© de rÃ©ception du certificat nÂ°{numero_certificat} a Ã©tÃ© confirmÃ©.\n\nDistribuÃ© le : {date}\n\nCordialement,\nNOMOÎ£', 'moe', 'moe_name,numero_certificat,date'),

-- Alertes (8 templates)
('CALENDRIER_SPECIAL', 'alerte', 'Calendrier exceptionnel â€” {motif}', 'Bonjour,\n\nUn calendrier exceptionnel est en vigueur :\n\nMotif : {motif}\nPÃ©riode : du {date_debut} au {date_fin}\n\nLes dates limites de dÃ©pÃ´t sont ajustÃ©es en consÃ©quence.\n\nCordialement,\nNOMOÎ£', 'all', 'motif,date_debut,date_fin'),
('CAUTION_EXPIRATION', 'alerte', 'Caution expire le {date} â€” {entreprise_name}', 'Bonjour {entreprise_name},\n\nVotre caution bancaire arrive Ã  expiration le {date}.\n\nâš ï¸ Sans renouvellement, une retenue de garantie de 5% sera automatiquement appliquÃ©e.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,date,moe_name'),
('ASSURANCE_EXPIREE', 'alerte', 'BLOCAGE â€” Assurance expirÃ©e â€” {entreprise_name}', 'Bonjour {entreprise_name},\n\nVotre attestation d''assurance {type_assurance} a expirÃ© le {date}.\n\nğŸ”´ CONSÃ‰QUENCE : Vos certificats de paiement sont BLOQUÃ‰S jusqu''Ã  rÃ©gularisation.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,type_assurance,date,moe_name'),
('ASSUREUR_LISTE_NOIRE', 'alerte', 'BLOCAGE â€” Assureur non acceptÃ© â€” {entreprise_name}', 'Bonjour {entreprise_name},\n\nL''assureur {assureur_name} n''est pas acceptÃ© par NOMOÎ£ (assureur en LPS ou sans reprÃ©sentation en France).\n\nğŸ”´ CONSÃ‰QUENCE : Vos certificats sont BLOQUÃ‰S.\n\nVeuillez fournir une attestation d''un assureur reconnu.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,assureur_name,moe_name'),
('PENALITE_APPLIQUEE', 'alerte', 'PÃ©nalitÃ© appliquÃ©e â€” {montant} â‚¬ â€” {lot_name}', 'Bonjour {entreprise_name},\n\nUne pÃ©nalitÃ© a Ã©tÃ© appliquÃ©e sur votre lot :\n\nMotif : {motif}\nRÃ©fÃ©rence CCAP : {reference}\nMontant : {montant} â‚¬\nType : {type}\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,montant,lot_name,motif,reference,type,moe_name'),
('SEUIL_PENALITE', 'alerte', 'ALERTE â€” Seuil pÃ©nalitÃ©s critique â€” {entreprise_name}', 'Attention,\n\nLe cumul des pÃ©nalitÃ©s pour {entreprise_name} (Lot {lot_name}) atteint {pourcentage}% du marchÃ©.\n\nSeuil critique : 5%\nCumul actuel : {montant} â‚¬\n\nCordialement,\nNOMOÎ£', 'moe', 'entreprise_name,lot_name,pourcentage,montant'),
('CHANGEMENT_STATUT', 'alerte', 'Entreprise {entreprise_name} â€” Changement statut', 'Attention,\n\nUn changement de statut a Ã©tÃ© dÃ©tectÃ© pour {entreprise_name} :\n\nNouveau statut : {statut}\n\nVeuillez vÃ©rifier les implications sur l''opÃ©ration.\n\nCordialement,\nNOMOÎ£', 'moe', 'entreprise_name,statut'),
('RECAP_MENSUEL_PEDIGREE', 'alerte', 'RÃ©capitulatif mensuel â€” Pedigrees Ã  problÃ¨me', 'Bonjour {moe_name},\n\nVoici le rÃ©capitulatif des Pedigrees nÃ©cessitant votre attention :\n\n{liste_problemes}\n\nCordialement,\nNOMOÎ£', 'moe', 'moe_name,liste_problemes'),

-- Cloture (5 templates)
('APPEL_FONDS_PRORATA', 'cloture', 'Appel fonds compte prorata â€” {mois}', 'Bonjour {entreprise_name},\n\nL''appel de fonds du compte prorata pour {mois} est de {montant} â‚¬.\n\nCordialement,\n{gestionnaire}', 'entreprise', 'entreprise_name,mois,montant,gestionnaire'),
('ARBITRAGE_ENTREPRISE', 'cloture', 'DÃ©cision arbitrage â€” {objet}', 'Bonjour {entreprise_name},\n\nSuite Ã  votre contestation, la dÃ©cision suivante a Ã©tÃ© prise :\n\n{decision}\n\nCordialement,\n{moa_name}', 'entreprise', 'entreprise_name,objet,decision,moa_name'),
('DGD_SIGNATURE', 'cloture', 'DGD â€” Signature requise â€” {lot_name}', 'Bonjour {entreprise_name},\n\nLe DÃ©compte GÃ©nÃ©ral DÃ©finitif pour votre lot est prÃªt.\n\nMontant DGD : {montant} â‚¬\n\nConnectez-vous Ã  NOMOÎ£ pour vÃ©rifier et signer.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,lot_name,montant,moe_name'),
('CLOTURE_MARCHE', 'cloture', 'ClÃ´ture marchÃ© â€” {operation_name}', 'Bonjour,\n\nLe marchÃ© pour l''opÃ©ration {operation_name} est officiellement clÃ´turÃ©.\n\nDate de clÃ´ture : {date}\n\nCordialement,\nNOMOÎ£', 'all', 'operation_name,date'),
('BIENVENUE_ENTREPRISE', 'cloture', 'Bienvenue sur NOMOÎ£ â€” {operation_name}', 'Bonjour {entreprise_name},\n\nVous avez Ã©tÃ© ajoutÃ© Ã  l''opÃ©ration {operation_name}.\n\nLot : {lot_name}\nMontant marchÃ© : {montant} â‚¬\n\nConnectez-vous Ã  NOMOÎ£ pour complÃ©ter votre Pedigree.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,operation_name,lot_name,montant,moe_name'),

-- Assurance (3 templates)
('ASSURANCE_J30', 'assurance', 'Assurance expire dans 30 jours â€” {entreprise_name}', 'Bonjour {entreprise_name},\n\nVotre {type_assurance} expire le {date}.\n\nMerci de renouveler et d''uploader la nouvelle attestation sur NOMOÎ£.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,type_assurance,date,moe_name'),
('ASSURANCE_J7', 'assurance', 'URGENT â€” Assurance expire dans 7 jours â€” {entreprise_name}', 'âš ï¸ Bonjour {entreprise_name},\n\nVotre {type_assurance} expire dans 7 JOURS ({date}).\n\nSans renouvellement, vos certificats seront BLOQUÃ‰S.\n\nCordialement,\n{moe_name}', 'entreprise', 'entreprise_name,type_assurance,date,moe_name'),
('LIBERATION_RG', 'assurance', 'LibÃ©ration retenue de garantie â€” {entreprise_name}', 'Bonjour,\n\nLa libÃ©ration de la retenue de garantie pour {entreprise_name} (Lot {lot_name}) est prÃ©vue dans 30 jours.\n\nMontant RG : {montant} â‚¬\n\nCordialement,\nNOMOÎ£', 'moe', 'entreprise_name,lot_name,montant');

-- Sample performance data
INSERT INTO performance_tracking (tenant_id, operation_id, situation_id, lot_id, date_depot, date_controle_opc, date_controle_moe, date_certificat, duree_opc_heures, duree_moe_heures, duree_totale_heures) VALUES
(1, 1, 1, 3, '2025-04-22 09:00:00', '2025-04-24 14:30:00', '2025-04-28 11:00:00', '2025-04-28 16:00:00', 53.5, 44.5, 151.0),
(1, 1, 2, 3, '2025-05-23 08:30:00', '2025-05-26 10:00:00', '2025-05-29 14:00:00', '2025-05-29 17:30:00', 73.5, 52.0, 153.0),
(1, 1, 3, 3, '2025-06-24 09:00:00', '2025-06-26 11:30:00', '2025-06-30 10:00:00', '2025-07-02 10:00:00', 50.5, 70.5, 193.0);
